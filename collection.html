<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Collection 路 TFire</title><meta name="title" content="Collection 路 TFire"/><meta property="og:title" content="Collection 路 TFire"/><meta property="twitter:title" content="Collection 路 TFire"/><meta name="description" content="Documentation for TFire."/><meta property="og:description" content="Documentation for TFire."/><meta property="twitter:description" content="Documentation for TFire."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/custom.css" rel="stylesheet" type="text/css"/><link href="assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="TFire logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">TFire</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><span class="tocitem">TFire</span><ul><li><a class="tocitem" href="index.html">Introduction</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href="collection.html">Collection</a><ul class="internal"><li><a class="tocitem" href="#Assets"><span>Assets</span></a></li><li><a class="tocitem" href="#TimeSeriesDataLink-(Developer)"><span>TimeSeriesDataLink  (Developer)</span></a></li><li><a class="tocitem" href="#Collection-Setup"><span>Collection Setup</span></a></li><li><a class="tocitem" href="#Collection-Settings"><span>Collection Settings</span></a></li><li><a class="tocitem" href="#Collection-Manipulation"><span>Collection Manipulation</span></a></li><li><a class="tocitem" href="#Donation"><span>Donation</span></a></li><li><a class="tocitem" href="#Functions"><span>Functions</span></a></li></ul></li><li><a class="tocitem" href="layers.html">Layers</a></li><li><a class="tocitem" href="specification.html">Specification</a></li><li><a class="tocitem" href="data_views.html">DataViews</a></li><li><a class="tocitem" href="returns.html">Returns</a></li><li><a class="tocitem" href="sfdb.html">SimpleFastDB</a></li><li><input class="collapse-toggle" id="menuitem-2-7" type="checkbox"/><label class="tocitem" for="menuitem-2-7"><span class="docs-label">External Data</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="external_data.html">External Data Handler</a></li><li><a class="tocitem" href="external_data_disk.html">Data From Disk</a></li><li><a class="tocitem" href="external_data_internet.html">Data From Internet</a></li><li><a class="tocitem" href="external_data_sources.html">Internet Data Sources</a></li><li><a class="tocitem" href="external_data_adding_source.html">Adding A New Data Source</a></li></ul></li><li><a class="tocitem" href="back_testing.html">Backtesting</a></li><li><a class="tocitem" href="layers_user_defined.html">Creating New Layers</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="tutorials/tutorial_basics.html">Basics</a></li><li><a class="tocitem" href="tutorials/tutorial_backtest.html">Backtesting</a></li></ul></li><li><span class="tocitem">List of Functions</span><ul><li><a class="tocitem" href="functions/functions_collection.html">Collection</a></li><li><a class="tocitem" href="functions/functions_specification.html">Specification</a></li><li><a class="tocitem" href="functions/functions_dataviews.html">DataViews</a></li><li><a class="tocitem" href="functions/functions_returns.html">Returns</a></li><li><a class="tocitem" href="functions/functions_sfdb.html">SimpleFastDB</a></li><li><a class="tocitem" href="functions/functions_edh.html">External Data Handler</a></li><li><a class="tocitem" href="functions/functions_backtest.html">Backtesting</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href="collection.html">Collection</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="collection.html">Collection</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Collection"><a class="docs-heading-anchor" href="#Collection">Collection</a><a id="Collection-1"></a><a class="docs-heading-anchor-permalink" href="#Collection" title="Permalink"></a></h1><p>The Collection is the centerpiece of TFire. It&#39;s a container of <a href="collection.html#Assets">Assets</a>,  for example stocks or, in principle, any entity which has associated time series data. Each such Asset is made up of a number of samples which represents individual views (or samples if you wish) of the corresponding time series data.</p><p>Some of the benefits of this layout are:</p><ul><li>Layers - A Collextion may connect <a href="layers.html#Layers">Layers</a>, a form of generalized indicators, to time series data. As the name suggests, these indicators may be layered on top of each other.</li></ul><ul><li>Safety - Various safeguards against Look-Ahead is automated, including safe use of repainting indicators.</li></ul><ul><li>Manipulation - Collections may be manipulated, accessed and filtered in a multitude of ways including the use of set operations. See <a href="collection.html#Collection-Manipulation">Collection Manipulation</a>.</li></ul><ul><li>Efficiency - Memory use is minimized, especially in the case of multiple analysis on the same time series.</li></ul><h2 id="Assets"><a class="docs-heading-anchor" href="#Assets">Assets</a><a id="Assets-1"></a><a class="docs-heading-anchor-permalink" href="#Assets" title="Permalink"></a></h2><p>Assets come in two variants, Continuous and Discrete, where the former is used for Assets with a continuous time series, for example a stock at a daily resolutio, or any continously traded asset like crypto curencies and currency pairs, whereas the latter is used when the underlying time series is discontinuous, for example a stock at minute resolution that is not traded 24/7. One collection can only have Assets of one sort.</p><h3 id="Samples"><a class="docs-heading-anchor" href="#Samples">Samples</a><a id="Samples-1"></a><a class="docs-heading-anchor-permalink" href="#Samples" title="Permalink"></a></h3><p>An Asset contains samples, which link to a part of the associated time series. Every such sample has one <em>evaluation date</em>, which is the last datetime of time series data accessable to the sample. By only evaluating returns after the evaluation date the risk of look ahead is minimized. The recommended way to access time series and Layer data for a sample are through <a href="data_views.html#DataViews">DataViews</a>.</p><center><img src="assets/collection_assets.png" alt="drawing" width="300"/></center><h2 id="Collection-Setup"><a class="docs-heading-anchor" href="#Collection-Setup">Collection Setup</a><a id="Collection-Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Collection-Setup" title="Permalink"></a></h2><pre><code class="nohighlight hljs">TFire&gt; collection = setup_collection(spec::Specification, sfdb::SimpleFastDB);</code></pre><p>Here, the <a href="specification.html#Specification">Specification</a> specifies which tickers and at what times to include in the collection. It also specifices what data fields (price, volume etc) to use. The <a href="sfdb.html#SimpleFastDB">SimpleFastDB</a> is the database where the raw time series data resides. For an example of how to set up a collection from scratch see <a href="tutorials/tutorial_basics.html#Tutorial-Basic-Analysis-of-Time-Series-Data">Tutorial - Basic Analysis of Time Series Data</a>.</p><h2 id="Collection-Settings"><a class="docs-heading-anchor" href="#Collection-Settings">Collection Settings</a><a id="Collection-Settings-1"></a><a class="docs-heading-anchor-permalink" href="#Collection-Settings" title="Permalink"></a></h2><p>The <code>Setting</code> contains all of the <code>Parameters</code> for a <a href="collection.html#Collection">Collection</a> and its <a href="layers.html#Layers">Layers</a>. Every collection has two associated Settings. The first, <code>settings_used</code> represents the settings that was actually used and thus fully describes the collection. The second one, <code>settings</code> are the settings that will be used if for example a new Layer is added.</p><p>The settings of some Collection <code>col</code> may be accessed with <code>col.settings</code> and <code>col.settings_used</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>It&#39;s important to understand and be comfortable with the difference between <code>settings_used</code> and <code>settings</code>.</p></div></div><p>Example:</p><pre><code class="nohighlight hljs">TFire&gt; settings = Settings()

TFire&gt; settings[LayerSMA][:win_sizes] =  [12,26];</code></pre><p>Here we have created a <code>Settings</code> entity and populated it with <code>Parameters</code> related to the Simple Moving Average layer type.</p><p>Some specific parameter in the Settings may be accesed with <code>[LayerType][:ParameterName]</code>:</p><pre><code class="nohighlight hljs">TFire&gt; settings[LayerSMA][:win_sizes]
[12, 26]
</code></pre><p>Trying to access a a LayerType not in the Settings results in an error.</p><pre><code class="nohighlight hljs">TFire&gt; settings[LayerMACD][:win_sizes]
ERROR: type LayerMACD not in Settings</code></pre><p>Every LayerType comes with default parameters which are used if nothing else is specified.</p><pre><code class="nohighlight hljs">TFire&gt; default_parameters(LayerSMA)
LayerSMA
:price =&gt; DefaultPrice()
:win_sizes =&gt; [45, 60]</code></pre><p>The <code>DefaultPrice()</code> is set in the Parameters for TSDLink, which handles the settings for the collection not related to any particular Layer.</p><pre><code class="nohighlight hljs">TFire&gt; TFire.default_parameters(TSDLink)
TSDLink
:resolution =&gt; &quot;1d&quot;
:default_price_field =&gt; :adj_close_log</code></pre><p>We can see that the default of the default price field is set to the adjusted closing price. Here is also where the resolution of the time series data in the collection is set. For more functions related to Settings and Parameters see <a href="functions/functions_settings.html#Settings-Functions">Settings - Functions</a>.</p><h2 id="Collection-Manipulation"><a class="docs-heading-anchor" href="#Collection-Manipulation">Collection Manipulation</a><a id="Collection-Manipulation-1"></a><a class="docs-heading-anchor-permalink" href="#Collection-Manipulation" title="Permalink"></a></h2><h3 id="Getindex"><a class="docs-heading-anchor" href="#Getindex">Getindex</a><a id="Getindex-1"></a><a class="docs-heading-anchor-permalink" href="#Getindex" title="Permalink"></a></h3><p>Examples of some of the ways of accessing parts of a Collection are presented below. All of the <code>getindex</code> methods presented below creates a new Collection. If instead the Collection is to be modified inplace, the equivalent <code>keepat!</code> method may be used.</p><p>Say we have the following Collection,</p><pre><code class="nohighlight hljs">TFire&gt; collection
-| Collection |- (Continuous)
Tickers: 2, MMM AOS
Samples: 8562</code></pre><p>The Collection may be accessed by one of the tickers in the Collection or a list of such tickers. This creates a Collection with only those tickers.</p><pre><code class="nohighlight hljs">TFire&gt; collection[&quot;MMM&quot;]
-| Collection |- (Continuous)
Ticker: MMM
Samples: 3352</code></pre><p>The Collection may also be accessed by one date/datetime in the collection, or again, a list of such dates/datetimes. This creates a Collection where only the samples with an evaluation date/datetime equivalent to those requested are kept for all Assets.</p><pre><code class="nohighlight hljs">TFire&gt; collection[Date(2010,1,12)]
-| Collection |- (Continuous)
Tickers: 2, MMM AOS
Samples: 2</code></pre><p>Further a Collection may be accessed by matching it to another Collection. In the example below the tickers and dates of <code>collection_mmm</code> is used to access <code>collection</code>.</p><pre><code class="nohighlight hljs">TFire&gt; collection_mmm = collection[&quot;MMM&quot;];

TFire&gt; collection_mmm_new = collection[collection_mmm]
-| Collection |- (Continuous)
Ticker: MMM
Samples: 3352

TFire&gt; collection_mmm == collection_mmm_new
true</code></pre><h3 id="Set-Operations"><a class="docs-heading-anchor" href="#Set-Operations">Set Operations</a><a id="Set-Operations-1"></a><a class="docs-heading-anchor-permalink" href="#Set-Operations" title="Permalink"></a></h3><p>Set operations are fully supported on Collections, Below follows some examples of set operations in combination with the getindex methods defined above.</p><pre><code class="nohighlight hljs">TFire&gt; collection[&quot;MMM&quot;] + collection[&quot;AOS&quot;] == collection
true</code></pre><p>Here the <code>+</code> is equivalent to the union operation. </p><pre><code class="nohighlight hljs">TFire&gt; collection - collection[&quot;AOS&quot;] == collection[&quot;MMM&quot;]
true</code></pre><p>The <code>-</code> is equivalent to the set difference operation. </p><pre><code class="nohighlight hljs">TFire&gt; intersect(collection, collection[&quot;MMM&quot;]) == collection[&quot;MMM&quot;]
true</code></pre><p>The <code>intersect</code> function here of course represents the intersect set operation.</p><h3 id="Filtering"><a class="docs-heading-anchor" href="#Filtering">Filtering</a><a id="Filtering-1"></a><a class="docs-heading-anchor-permalink" href="#Filtering" title="Permalink"></a></h3><p>A Collection may be filtered by a user defined function acting on any <a href="data_views.html#DataViews">DataView</a> of the Collection.</p><p>Below is an example taken from <a href="tutorials/tutorial_basics.html#Tutorial-Basic-Analysis-of-Time-Series-Data">Tutorial - Basic Analysis of Time Series Data</a>, where a Collection with an MACD Layer is filtered with a user defined function <code>macd_signal</code>.</p><pre><code class="nohighlight hljs">TFire&gt; function macd_signal(macd_hist)
          return macd_hist[end-1] &lt; 0 &amp;&amp; macd_hist[end] &gt; 0
       end

TFire&gt; dv_macd = DVLayerField(collection_macd, :macd_histogram, LayerMACD);

TFire&gt; filter_collection!(collection_macd_copy, dv_macd, macd_signal; action=:keep)</code></pre><h2 id="Donation"><a class="docs-heading-anchor" href="#Donation">Donation</a><a id="Donation-1"></a><a class="docs-heading-anchor-permalink" href="#Donation" title="Permalink"></a></h2><p>Donations of one Collection to another is a way to make data in the donating Collection available through the recieving Collection. Say we have a Collection <code>collection_donator</code> and another, <code>collection_reciever</code>. A DonationProtocol specifies which Assets in <code>collection_donor</code> that donate to which Assets in <code>collection_reciever</code>. One Asset may be donated to several Assets or several to one. If nothing is specified then Assets are matched such that Assets in <code>collection_reciever</code>are recieve a donation from the same Asset in <code>collection_donor</code>. The datetimes of the donor is matched to those of the reciever. A Collation may recieve donations from several Collections.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The donating Collection needs to contain all evaluation dates of the recieving Collection.</p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>When a Collection has been donated a copy of the donated Collection is made. This copy is locked and may itself not be modified or donated again.</p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>It is possible to receieve donations from several Collections. Hur fungerar det med dataview?</p></div></div><h3 id="Uses"><a class="docs-heading-anchor" href="#Uses">Uses</a><a id="Uses-1"></a><a class="docs-heading-anchor-permalink" href="#Uses" title="Permalink"></a></h3><p>One use of donating Collections is to combine several different Layers on the same Asset. Since one collection may only contain one chain of Layers this has to be done via donations. This is a typical case where every Asset recieves donations from the same Asset in one or several other Collections.</p><p>Recieving donations from other Assets is useful either for cases when one Asset is to be traded based on signals from other Assets or if those signals are to be combined with the recieving Asset, for example in the case of correlations studies.</p><h3 id="Performing-Donation"><a class="docs-heading-anchor" href="#Performing-Donation">Performing Donation</a><a id="Performing-Donation-1"></a><a class="docs-heading-anchor-permalink" href="#Performing-Donation" title="Permalink"></a></h3><p>Example:</p><pre><code class="nohighlight hljs">TFire&gt; collection_new = donate(collection_reciever, collection_donor);</code></pre><p>A new Collection <code>collection_new</code> is created by donating <code>collection_donor</code> to <code>collection_reciever</code>. Since no DonationProtocol os specified <code>collection_donor</code> donates Asset with ticker x to Asset with ticker x in <code>collection_reciever</code>.</p><pre><code class="nohighlight hljs">TFire&gt; dp = dp_all_to_all(collection_reciever, collection_donor);

TFire&gt; collection_new = donate(collection_reciever, collection_donor, dp);</code></pre><p>Here, the shorthand function <code>dp_all_to_all</code> is used to create a DonationProtocol specifying that every Asset in <code>collection_reciever</code> should recieve donations from all Assets in <code>collection_donor</code>.</p><h3 id="Accessing-the-Donated-Data"><a class="docs-heading-anchor" href="#Accessing-the-Donated-Data">Accessing the Donated Data</a><a id="Accessing-the-Donated-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-the-Donated-Data" title="Permalink"></a></h3><p>The information from the donated Collection is accessed thorugh special <a href="data_views.html#DataViews">DataViews</a> acting on the donated<em>asset</em>link.</p><p>Example</p><pre><code class="nohighlight hljs">TFire&gt; col_opt = add_layer(collection, LayerOptimaRolling);

TFire&gt; col_don = donate(col_opt, col_opt); # The Collection is donated to itself.

TFire&gt; a = get_first_asset(col_don[&quot;MMM&quot;]); # Returns the asset for ticker &quot;MMM&quot;

TFire&gt; dal = get_donated_asset_link(a, &quot;MMM&quot;); # Returns the donated asset with ticker &quot;MMM&quot; that is linked to the asset with ticker &quot;MMM&quot;.

TFire&gt; de = DVLayerField(a, :tics); # Creates an ordinary DataView of the &quot;tics&quot; field in the outermost layer.

TFire&gt; dem = DVLayerField(dal, :tics); # Creates a DataView of the &quot;tics&quot; field from the donated asset.

TFire&gt; de[10] == dem[10] # The two DataViews return the same values.
true

TFire&gt; de[10] === dem[10] # But they are still separate entities.
false
</code></pre><h3 id="Donate-Functions"><a class="docs-heading-anchor" href="#Donate-Functions">Donate Functions</a><a id="Donate-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Donate-Functions" title="Permalink"></a></h3><p>Functions related to Collation donation may be found at <a href="functions/functions_collection.html#Collection-Donation-Functions">Collection Donation - Functions</a></p><h2 id="Functions"><a class="docs-heading-anchor" href="#Functions">Functions</a><a id="Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Functions" title="Permalink"></a></h2><p>For functions related to the Collection see <a href="functions/functions_collection.html#Collection-Functions">Collection - Functions</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">芦 Introduction</a><a class="docs-footer-nextpage" href="layers.html">Layers 禄</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Wednesday 10 April 2024 12:46">Wednesday 10 April 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
