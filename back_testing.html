<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Backtesting · TFire</title><meta name="title" content="Backtesting · TFire"/><meta property="og:title" content="Backtesting · TFire"/><meta property="twitter:title" content="Backtesting · TFire"/><meta name="description" content="Documentation for TFire."/><meta property="og:description" content="Documentation for TFire."/><meta property="twitter:description" content="Documentation for TFire."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/custom.css" rel="stylesheet" type="text/css"/><link href="assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="TFire logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">TFire</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="collection.html">Collection</a></li><li><a class="tocitem" href="layers.html">Layers</a></li><li><a class="tocitem" href="data_views.html">DataViews</a></li><li><a class="tocitem" href="returns.html">Returns</a></li><li><a class="tocitem" href="sfdb.html">SimpleFastDB</a></li><li><a class="tocitem" href="specification.html">Specification</a></li><li><a class="tocitem" href="external_data.html">External Data Handler</a></li><li class="is-active"><a class="tocitem" href="back_testing.html">Backtesting</a><ul class="internal"><li><a class="tocitem" href="#Scoring"><span>Scoring</span></a></li><li><a class="tocitem" href="#Portfolio"><span>Portfolio</span></a></li><li><a class="tocitem" href="#Propagating-the-Portfolio"><span>Propagating the Portfolio</span></a></li><li><a class="tocitem" href="#Analysis-of-PortfolioHistory"><span>Analysis of PortfolioHistory</span></a></li><li><a class="tocitem" href="#Trading-Dates"><span>Trading Dates</span></a></li><li><a class="tocitem" href="#Functions"><span>Functions</span></a></li></ul></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="tutorials/tutorial_basics.html">Basics</a></li><li><a class="tocitem" href="tutorials/tutorial_backtest.html">Backtesting</a></li></ul></li><li><span class="tocitem">List of Functions</span><ul><li><a class="tocitem" href="functions/functions_collection.html">Collection</a></li><li><a class="tocitem" href="functions/functions_dataviews.html">DataViews</a></li><li><a class="tocitem" href="functions/functions_returns.html">Returns</a></li><li><a class="tocitem" href="functions/functions_sfdb.html">SimpleFastDB</a></li><li><a class="tocitem" href="functions/functions_specification.html">Specification</a></li><li><a class="tocitem" href="functions/functions_edh.html">External Data Handler</a></li><li><a class="tocitem" href="functions/functions_backtest.html">Backtesting</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href="back_testing.html">Backtesting</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="back_testing.html">Backtesting</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Backtesting"><a class="docs-heading-anchor" href="#Backtesting">Backtesting</a><a id="Backtesting-1"></a><a class="docs-heading-anchor-permalink" href="#Backtesting" title="Permalink"></a></h1><p>Backtesting in TFire is carried out by propagating a PortfolioHistory forward in time. Each timestep of the PortfolioHistory contains a PortfolioAtDate object which contains the information about holding quantities at that date. Every timestep the portfolio is reweighted based on a scoring function.</p><h2 id="Scoring"><a class="docs-heading-anchor" href="#Scoring">Scoring</a><a id="Scoring-1"></a><a class="docs-heading-anchor-permalink" href="#Scoring" title="Permalink"></a></h2><p>To determine which holdings to buy and sell, TFire uses a scoring function. When propagating the PortfolioHistory the weighting of each holding is determined by a ScoreHold object that for each holding and trading date contains a nonnegative real number representing its score. The ScoreHold also contains a score for cash at each trading date.</p><h3 id="Portfolio-Weightings-from-ScoreHold"><a class="docs-heading-anchor" href="#Portfolio-Weightings-from-ScoreHold">Portfolio Weightings from ScoreHold</a><a id="Portfolio-Weightings-from-ScoreHold-1"></a><a class="docs-heading-anchor-permalink" href="#Portfolio-Weightings-from-ScoreHold" title="Permalink"></a></h3><p>The weighting of holding <em>k</em> at timestep <em>i</em> is calculated as follows:</p><p><span>$\text{weight}_{k, i} = \frac{\text{score}_{k, i}}{\sum_{k} \text{score}_{k, i} + \text{score}_{\text{cash}, i}}$</span></p><p>where <br/><span>$\text{weight}_{k, i}$</span> represents the weighting of holding <em>k</em> at timestep <em>i</em>  <br/><span>$\text{score}_{k, i}$</span> represents the score of holding <em>k</em> at timestep <em>i</em>  <br/><span>$\text{score}_{\text{cash}, i}$</span> represents the score of cash at timestep <em>i</em> </p><p>And of course the weighting of cash at timestep <em>i</em> is:</p><p><span>$\text{weight}_{\text{cash}, i} = \frac{\text{score}_{cash, i}}{\sum_{k} \text{score}_{k, i} + \text{score}_{\text{cash}, i}}$</span></p><p>The sum of all weights always equals 1.</p><p><span>$\sum_{k} \text{weight}_{k, i} + \text{score}_{cash, i} = 1$</span></p><h3 id="Constructiong-ScoreHold"><a class="docs-heading-anchor" href="#Constructiong-ScoreHold">Constructiong ScoreHold</a><a id="Constructiong-ScoreHold-1"></a><a class="docs-heading-anchor-permalink" href="#Constructiong-ScoreHold" title="Permalink"></a></h3><p>A ScoreHold may be constructed in several different ways. Below follows a description of the two most common ways.</p><h4 id="ScoreHold-From-ScoreBuy-and-ScoreSell"><a class="docs-heading-anchor" href="#ScoreHold-From-ScoreBuy-and-ScoreSell">ScoreHold From ScoreBuy and ScoreSell</a><a id="ScoreHold-From-ScoreBuy-and-ScoreSell-1"></a><a class="docs-heading-anchor-permalink" href="#ScoreHold-From-ScoreBuy-and-ScoreSell" title="Permalink"></a></h4><p>A ScoreHold may be created by combining a ScoreBuy and a ScoreSell:</p><p><a href="functions/functions_backtest.html#TFire.ScoreHold-Tuple{ScoreBuy, ScoreSell, TradingDates}"><code>ScoreHold(buy_scores::ScoreBuy, sell_scores::ScoreSell, td::TradingDates)</code></a></p><p>When a holding is given a score from ScoreBuy the ScoreHold keeps that score for all future trading dates until either a new <em>higher</em> score is obtained from ScoreBuy or the score is subtracted by a score in ScoreSell.</p><p>An example may make this more clear. Say we have a Portfolio with only one potential holding.</p><table><tr><th style="text-align: left">Trading Day</th><th style="text-align: center">ScoreHold</th><th style="text-align: center">ScoreBuy</th><th style="text-align: center">ScoreSell</th></tr><tr><td style="text-align: left">1</td><td style="text-align: center">0.</td><td style="text-align: center">-</td><td style="text-align: center">-</td></tr><tr><td style="text-align: left">2</td><td style="text-align: center">1.</td><td style="text-align: center">1.</td><td style="text-align: center">-</td></tr><tr><td style="text-align: left">3</td><td style="text-align: center">1.</td><td style="text-align: center">0.7</td><td style="text-align: center">-</td></tr><tr><td style="text-align: left">4</td><td style="text-align: center">2.</td><td style="text-align: center">2.</td><td style="text-align: center">-</td></tr><tr><td style="text-align: left">5</td><td style="text-align: center">2.</td><td style="text-align: center">-</td><td style="text-align: center">-</td></tr><tr><td style="text-align: left">6</td><td style="text-align: center">1.5</td><td style="text-align: center">-</td><td style="text-align: center">0.5</td></tr><tr><td style="text-align: left">7</td><td style="text-align: center">0.</td><td style="text-align: center">-</td><td style="text-align: center">3.</td></tr><tr><td style="text-align: left">8</td><td style="text-align: center">0.</td><td style="text-align: center">1.</td><td style="text-align: center">3.</td></tr></table><h4 id="ScoreHold-From-Extending-ScoreBuy"><a class="docs-heading-anchor" href="#ScoreHold-From-Extending-ScoreBuy">ScoreHold From Extending ScoreBuy</a><a id="ScoreHold-From-Extending-ScoreBuy-1"></a><a class="docs-heading-anchor-permalink" href="#ScoreHold-From-Extending-ScoreBuy" title="Permalink"></a></h4><p>A ScoreHold may be created by extending a ScoreBuy:</p><p><a href="functions/functions_backtest.html#TFire.score_extend-Tuple{ScoreBuy, TradingDates}"><code>score_extend(score_buy::ScoreBuy, td::TradingDates)</code></a></p><p>We may again clarify this with an example portfolio with one holding. Here we extend it by 3 constant trading dates (this includes the ScoreBuy date) and then a linear fallof of 3 dates.</p><pre><code class="language- hljs">julia&gt; score_extend(score_buy::ScoreBuy, td::TradingDates; constant_ticks=3,linear_ticks=3)</code></pre><table><tr><th style="text-align: left">Trading Day</th><th style="text-align: center">ScoreHold</th><th style="text-align: center">ScoreBuy</th></tr><tr><td style="text-align: left">1</td><td style="text-align: center">0.</td><td style="text-align: center">-</td></tr><tr><td style="text-align: left">2</td><td style="text-align: center">1.</td><td style="text-align: center">1.</td></tr><tr><td style="text-align: left">3</td><td style="text-align: center">1.</td><td style="text-align: center">-</td></tr><tr><td style="text-align: left">4</td><td style="text-align: center">1.</td><td style="text-align: center">-</td></tr><tr><td style="text-align: left">5</td><td style="text-align: center">0.75</td><td style="text-align: center">-</td></tr><tr><td style="text-align: left">6</td><td style="text-align: center">0.5</td><td style="text-align: center">-</td></tr><tr><td style="text-align: left">7</td><td style="text-align: center">0.25</td><td style="text-align: center">-</td></tr></table><h2 id="Portfolio"><a class="docs-heading-anchor" href="#Portfolio">Portfolio</a><a id="Portfolio-1"></a><a class="docs-heading-anchor-permalink" href="#Portfolio" title="Permalink"></a></h2><p>A portfolio at one single time is represented by a PortfolioAtDate object. It contains the information about the quantity of all holdings and cash at that date. A PortfolioHistory contains two PortfolioAtDate objects per trading date, one that represents the portfolio before holdings are reweighted and one after.</p><h3 id="PortfolioAtDate"><a class="docs-heading-anchor" href="#PortfolioAtDate">PortfolioAtDate</a><a id="PortfolioAtDate-1"></a><a class="docs-heading-anchor-permalink" href="#PortfolioAtDate" title="Permalink"></a></h3><p>if <code>pfad</code> is a PortfolioAtDate then</p><p><a href="functions/functions_backtest.html#TFire.get_tickers-Tuple{PortfolioAtDate}"><code>get_tickers(pfad)</code></a> returns a vector with the tickers of all holdings in the PortfolioAtDate</p><p><a href="functions/functions_backtest.html#TFire.get_quantities-Tuple{PortfolioAtDate}"><code>get_quantities(pfad)</code></a> returns a vector with the quantities of all holdings in the PortfolioAtDate</p><p><a href="functions/functions_backtest.html#TFire.get_prices-Tuple{PortfolioAtDate}"><code>get_prices(pfad)</code></a> returns a vector with the prices of all holdings in the PortfolioAtDate</p><p><a href="functions/functions_backtest.html#TFire.get_values-Tuple{PortfolioAtDate}"><code>get_values(pfad)</code></a> returns a vector with the values of all holdings in the PortfolioAtDate</p><p>All vectors are in the same order.</p><p>Further</p><pre><code class="language- hljs">pfad.cash # returns the cash in the PortfolioAtDate

pfad.date # returns the date of the PortfolioAtDate</code></pre><h4 id="Setup-of-PortfolioAtDate"><a class="docs-heading-anchor" href="#Setup-of-PortfolioAtDate">Setup of PortfolioAtDate</a><a id="Setup-of-PortfolioAtDate-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-of-PortfolioAtDate" title="Permalink"></a></h4><p>To setup an initial PortfolioAtDate from a Collection we use the <a href="functions/functions_backtest.html#TFire.initialize_portfolio-Union{Tuple{T}, Tuple{Collection{TFire.AssetsCon{T}}, DateTime}, Tuple{Collection{TFire.AssetsCon{T}}, DateTime, Float64}} where T&lt;:TFire.Assets"><code>initialize_portfolio()</code></a> function. The function takes a Collection and a datetime and creates a PortfolioAtDate at that datetime with all the Assets in the Collection available as holdings. It also takes a cash argument which will set the amount of cash available. All holding qunatities are set to 0.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>All holdings that are to be potentially bought or sold in the PortfolioHistory needs to exist in the initial PortfolioAtDate.</p></div></div><h3 id="PortfolioHistory"><a class="docs-heading-anchor" href="#PortfolioHistory">PortfolioHistory</a><a id="PortfolioHistory-1"></a><a class="docs-heading-anchor-permalink" href="#PortfolioHistory" title="Permalink"></a></h3><p>If <code>pfh</code> is a PortfolioHistory then</p><pre><code class="language- hljs">pfh.name # returns or sets the name of the portfolio.

pfh.pf_before_rw # returns a vector of PortfolioAtDate objects representing the portfolio before holdings are reweighted for each trading date.

pfh.pf_after_rw # returns a vector of PortfolioAtDate objects representing the portfolio after holdings are reweighted for each trading date.</code></pre><h2 id="Propagating-the-Portfolio"><a class="docs-heading-anchor" href="#Propagating-the-Portfolio">Propagating the Portfolio</a><a id="Propagating-the-Portfolio-1"></a><a class="docs-heading-anchor-permalink" href="#Propagating-the-Portfolio" title="Permalink"></a></h2><p>A PortfolioHistory may be created either from propagating a PortfolioAtDate or directly from a ScoreHold. At each timestep the portfolio is reweighted according to the ScoreHold. Both methods support both a constant and a proportional fee which is applied directly at the time of reweighting the portfolio.</p><h3 id="PortfolioHistory-from-PortfolioAtDate"><a class="docs-heading-anchor" href="#PortfolioHistory-from-PortfolioAtDate">PortfolioHistory from PortfolioAtDate</a><a id="PortfolioHistory-from-PortfolioAtDate-1"></a><a class="docs-heading-anchor-permalink" href="#PortfolioHistory-from-PortfolioAtDate" title="Permalink"></a></h3><p>When starting from a PortfolioAtDate we use the <a href="functions/functions_backtest.html#TFire.propagate_portfolio-Tuple{PortfolioAtDate, DateTime, ScoreHold}"><code>propagate_portfolio()</code></a> function. This function takes a PortfolioAtDate, a datetime which to propagate to and a ScoreHold. The TradingDates used are determined from the input portfolio.</p><h3 id="PortfolioHistory-from-ScoreHold"><a class="docs-heading-anchor" href="#PortfolioHistory-from-ScoreHold">PortfolioHistory from ScoreHold</a><a id="PortfolioHistory-from-ScoreHold-1"></a><a class="docs-heading-anchor-permalink" href="#PortfolioHistory-from-ScoreHold" title="Permalink"></a></h3><p>A PortfolioHistory may also be created directly from a ScoreHold:</p><p><a href="functions/functions_backtest.html#TFire.PortfolioHistory-Tuple{ScoreHold}"><code>PortfolioHistory(sh::ScoreHold;start_date=DateTime(0000,01,01), start_cash=1., fee_type=:free, prop_fee=0., fixed_fee=0)</code></a></p><p>Since no PortfolioAtDate is given the PortfolioHistory is created with all the holdings in the ScoreHold available. The <code>start_date</code> and <code>start_cash</code> are optional. The portfolio is propagated to the last date in ScoreHold.</p><h2 id="Analysis-of-PortfolioHistory"><a class="docs-heading-anchor" href="#Analysis-of-PortfolioHistory">Analysis of PortfolioHistory</a><a id="Analysis-of-PortfolioHistory-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis-of-PortfolioHistory" title="Permalink"></a></h2><p>The following mostly self explanatory functions are useful when evaluationg a trading strategy:</p><p><a href="functions/functions_backtest.html#TFire.sharpe_ratio-Tuple{PortfolioHistory}"><code>sharpe_ratio(pfh::PortfolioHistory)</code></a></p><p><a href="functions/functions_backtest.html#TFire.maximum_drawdown-Tuple{PortfolioHistory}"><code>maximum_drawdown(pfh::PortfolioHistory)</code></a></p><p><a href="functions/functions_backtest.html#TFire.plot_portfolio-Tuple{PortfolioHistory}"><code>plot_portfolio(pfh::PortfolioHistory)</code></a></p><p><a href="functions/functions_backtest.html#TFire.plot_portfolio-Tuple{PortfolioHistory, PortfolioHistory}"><code>plot_portfolio(pfh::PortfolioHistory, pfh2::PortfolioHistory)</code></a></p><p><a href="functions/functions_backtest.html#TFire.plot_portfolio-Tuple{Vector{PortfolioHistory}}"><code>plot_portfolio(pfh_vect::Vector{PortfolioHistory})</code></a></p><p><a href="functions/functions_backtest.html#TFire.plot_portfolio_proportions-Tuple{PortfolioHistory}"><code>plot_portfolio_proportions(pfh::PortfolioHistory)</code></a></p><h2 id="Trading-Dates"><a class="docs-heading-anchor" href="#Trading-Dates">Trading Dates</a><a id="Trading-Dates-1"></a><a class="docs-heading-anchor-permalink" href="#Trading-Dates" title="Permalink"></a></h2><p>When propagating a portfolio, all trading dates between the start date and the finish date needs to be specified by a TradingDates object which contains a chronologically sorted vector of trading dates. Often it may be automatically deduced but sometimes it needs to be explicitly created. Below follows a few ways of creating it.</p><p><a href="functions/functions_backtest.html#TFire.TradingDates-Tuple{PortfolioAtDate}"><code>TradingDates(col::Collection) where T &lt;: Assets</code></a> </p><p>Creates TradingDates from a Collection.</p><p><a href="functions/functions_backtest.html#TFire.TradingDates-Tuple{Vector{TimeSeries}}"><code>TradingDates(vts::Vector{TimeSeries})</code></a> </p><p>Creates TradingDates from a vector of TimeSeries.</p><p><a href="functions/functions_backtest.html#TFire.TradingDates-Tuple{PortfolioAtDate}"><code>TradingDates(pf::PortfolioAtDate)</code></a></p><p>Creates TradingDates from a PortfolioAtDate.</p><h2 id="Functions"><a class="docs-heading-anchor" href="#Functions">Functions</a><a id="Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Functions" title="Permalink"></a></h2><p>For a list of related functions see <a href="functions/functions_backtest.html#Backtesting-Functions">Backtesting - Functions</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="external_data.html">« External Data Handler</a><a class="docs-footer-nextpage" href="tutorials/tutorial_basics.html">Basics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Monday 29 January 2024 01:17">Monday 29 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
